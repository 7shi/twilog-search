# tag_cooc

## なぜこの実装が存在するか

### タグ間の関係性分析需要
**Problem**: 個別のタグ使用頻度は把握できるが、タグ同士がどのような組み合わせで使用されているか、どのタグが一緒に使われる傾向があるかを分析する手段がなかった。

**Solution**: 同一投稿内のタグペアの組み合わせを生成し、共起回数をカウントする機能を実装。最頻出タグペアと統計情報により、タグ間の関係性を定量的に把握可能とした。

### 組み合わせ生成における順序統一
**Problem**: タグペア「A-B」と「B-A」が別々にカウントされると、同じ関係性が重複して集計され、正確な共起分析ができない。

**Solution**: combinationsとsortedを組み合わせ、常に辞書順でタグペアを生成することで、同一の関係性を一意に識別する仕組みを実装。これにより重複のない正確な共起カウントを実現。

### 特定タグとの関係性分析機能
**Problem**: 全体的な共起傾向は分かるが、特定のタグ（例：「数学」「AI」）がどのようなタグと組み合わせて使われているかを個別に分析する必要があった。

**Solution**: 指定したタグとの共起関係を抽出し、関連度の高いタグを順位付けして表示する機能を実装。これにより特定分野のタグクラスターの把握が可能になった。

### 共起データの効率的な構造化
**Problem**: 大量のタグペアの共起データを効率的に集計・検索するためのデータ構造が必要だった。

**Solution**: Counterを使用してタグペアをキーとした共起回数の高速集計を実現。タプルをキーとすることで、ペアの一意性を保ちながら効率的な検索・ソートが可能になった。

### 投稿単位での共起計算
**Problem**: 全てのタグペアを生成すると、異なる投稿間の無関係なタグペアも含まれ、真の共起関係を正確に反映できない。

**Solution**: 各投稿（post_id）内のタグのみから組み合わせを生成することで、実際に同じ文脈で使用されたタグペアのみを対象とした共起分析を実現。これにより意味のある関係性の抽出が可能になった。

### 共起タグ数による中心性分析
**Problem**: 単純な共起回数ランキングでは、特定のタグペアの強い関係性は分かるが、各タグがどの程度「中心的」な概念であるかを把握できない。

**Solution**: 各タグの共起タグ数（何種類のタグと共起するか）をカウントし、降順でランキング表示する機能を実装。これにより「AI」「数学」など多様な概念と関連する中心的なタグを特定可能とした。

### 関連タグの比率表示による構造理解
**Problem**: 共起タグ数は分かるが、それぞれの関連タグがどの程度の重要度を持つかが不明で、タグ間の関係性の強弱を定量的に把握できない。

**Solution**: 各タグの総共起回数に対する個別関連タグの比率を計算し、パーセンテージで表示する機能を実装。これにより「数学」の関連タグで「物理学」が7.8%を占めるなど、関係性の強さを数値で把握可能になった。

### 多行レイアウトによる視認性向上
**Problem**: 12個の関連タグを1行で表示すると横幅が長くなりすぎ、画面に収まらない場合や読みにくい場合がある。

**Solution**: 関連タグを4個ずつ3行に分割し、2・3行目のインデントを1行目の関連タグ開始位置に揃える表示形式を実装。これにより画面幅に収まりやすく、かつ多くの関連情報を効率的に表示可能になった。

### TagReader統合による一元化
**Problem**: TSVファイルを直接読み込むと、他のタグ分析ツールとの間でデータ読み込み処理が重複し、一貫性とメンテナンス性に課題があった。

**Solution**: TagReaderクラスを使用してデータ読み込みを統一化。遅延importによる軽量化（load_vectors=False）と、統一されたデータアクセス層により、コード重複を削除し保守性を向上。