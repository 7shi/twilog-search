# 要約ベクトル検索による原文反映性検証

## なぜこの実装が存在するか

### LLM要約とベクトル埋め込みモデル間の一貫性検証の必要性
**Problem**: Gemini APIによって生成された22万件の要約データが、SentenceTransformersによる埋め込みモデルから見て原文投稿を適切に反映しているかが未検証であった。LLMと埋め込みモデルは異なるアーキテクチャを持つため、LLMが「良い要約」と判断した内容が、埋め込みモデルのベクトル空間では原文と類似しない可能性があり、この不整合は検索システムにとって致命的である。

**Solution**: 要約をクエリとしてベクトル検索を実行し、100位以内に元の投稿が現れるかを定量的に測定する逆引き検証システムを実装。実際の検索フローと同じ条件で両モデル間の一貫性を直接検証することで、システム全体の品質保証を実現する。

### ハイブリッド検索システムの基盤品質保証の重要性
**Problem**: ハイブリッド検索システムでは要約ベクトル検索が重要な役割を果たすが、その精度が未検証では実用性の判断ができない。特に、検索における要約データの実用性と、検索精度改善の方向性決定に必要な客観的指標が不足していた。

**Solution**: 固定シード42による再現可能な検証を実装し、統計的分析により要約品質を4段階（優秀/良好/普通/要改善）で客観評価する。これにより、システム改善の判断材料と今後の要約生成戦略の基盤データを提供する。

### 複数検索モードでの比較検証の必要性
**Problem**: ハイブリッド検索システムでは複数の検索モード（content, reasoning, summary）が利用可能だが、要約をクエリとした場合にどのモードが最も高い原文発見精度を持つかが不明であった。モード選択の最適化により検索精度を大幅に向上させる可能性があった。

**Solution**: 検索モードを引数で指定可能にし、同一のサンプルセット（固定シード）で複数モードの性能を比較評価する。これにより、モード間の客観的な性能差を定量化し、最適なモード選択の根拠を提供する。

## 実験により得られた重要な知見

### Reasoning検索の圧倒的優位性
実験結果により、mode=reasoningがmode=contentを大幅に上回る性能を示すことが実証された：

- **発見率**: content 92.0% → reasoning 96.0% (+4%)
- **平均順位**: content 3.2位 → reasoning 1.3位（2.5倍改善）
- **1位獲得率**: content 64% → reasoning 84% (+20%)

この結果は、LLMが生成した「reasoning」（なぜその要約になったかの理由）が、元投稿の意図や文脈をより深く反映し、埋め込みモデルとの相性が極めて良好であることを示している。

### ベクトル検索システムへの設計指針
検証により明らかになった設計原則：

1. **思考過程の重要性**: 要約だけでなくLLMの思考過程（reasoning）も含めたベクトル化により、より精密な意味的検索が可能
2. **高い実用性**: 96%の発見率により、要約ベクトル検索がハイブリッド検索システムで十分機能することを実証
3. **モデル間相性**: Gemini APIとSentenceTransformersの組み合わせが高い相性を持つことを定量的に確認

### 検索システム最適化への影響
この発見により、ハイブリッド検索システムの性能向上策が明確化された：

- **reasoning検索の活用**: ハイブリッド検索でのreasoning検索採用により検索精度の大幅向上が期待
- **品質保証基準**: 発見率95%以上を「優秀」とする客観的品質基準の確立
- **継続的改善**: 固定シード検証による再現可能な品質測定手法の確立

この検証システムにより、LLM生成要約と埋め込みモデルの相性を定量評価し、検索システム全体の品質向上に寄与する基盤が構築された。